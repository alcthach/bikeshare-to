[[2023-01-24]]

---

09:50

From what I remember, I'm currently blocked on the heterogeneity of the elements found in `stations`. The focus of today's session is to see if I can find and implement a solution for this issue.

The fpl project might have a solution?

It's a lead... However, it might help for me to take a look at what the csv file looks.

I profiled the data and it seems like the `csv` module might have imputed the missing values with `NaNs`. I'll just need to solve the issue of the mis-indexed fields now.

Which might mean I have to find a more robust pattern. Or I have to find the correct order in which the columns are ordered in, since the function is able to impute null values.

Actually, there is some issue here. I don't think I could use `csvwriter.writerows()`. It doesn't seem like the function is smart enough to perform that operation. The imputations might actually be the work of pandas. From what I'm seeing, the `writerows()` function takes whatever values are found in the object and transcribes it to the file object. 

I might have to revisit the `DictWriter()` to see if there's a solution there.


_class_ csv.DictWriter(_f_, _fieldnames_, _restval=''_, _extrasaction='raise'_, _dialect='excel'_, _*args_, _**kwds_)[¶](https://docs.python.org/3/library/csv.html#csv.DictWriter "Permalink to this definition")

Create an object which operates like a regular writer but maps dictionaries onto output rows. The _fieldnames_ parameter is a [`sequence`](https://docs.python.org/3/library/collections.abc.html#module-collections.abc "collections.abc: Abstract base classes for containers") of keys that identify the order in which values in the dictionary passed to the `writerow()` method are written to file _f_. The optional _restval_ parameter specifies the value to be written if the dictionary is missing a key in _fieldnames_. If the dictionary passed to the `writerow()` method contains a key not found in _fieldnames_, the optional _extrasaction_ parameter indicates what action to take. If it is set to `'raise'`, the default value, a [`ValueError`](https://docs.python.org/3/library/exceptions.html#ValueError "ValueError") is raised. If it is set to `'ignore'`, extra values in the dictionary are ignored. Any other optional or keyword arguments are passed to the underlying [`writer`](https://docs.python.org/3/library/csv.html#csv.writer "csv.writer") instance.

Note that unlike the [`DictReader`](https://docs.python.org/3/library/csv.html#csv.DictReader "csv.DictReader") class, the _fieldnames_ parameter of the [`DictWriter`](https://docs.python.org/3/library/csv.html#csv.DictWriter "csv.DictWriter") class is not optional.

- This seems like it might be useful 
- I'll try it out

``` python
import csv

with open('names.csv', 'w', newline='') as csvfile:
    fieldnames = ['first_name', 'last_name']
    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)

    writer.writeheader()
    writer.writerow({'first_name': 'Baked', 'last_name': 'Beans'})
    writer.writerow({'first_name': 'Lovely', 'last_name': 'Spam'})
    writer.writerow({'first_name': 'Wonderful', 'last_name': 'Spam'})
```

``` python
_class_ csv.DictWriter(_f_, _fieldnames_, _restval=''_, _extrasaction='raise'_, _dialect='excel'_, _*args_, _**kwds_)[](https://docs.python.org/3/library/csv.html#csv.DictWriter "Permalink to this definition")
```

- I'll have to pass the file to be written, in this case let's call it `stations.csv`
- I'll have to pass a list of the headers, which is generated by the function I borrowed the other day
- It's interesting how there's a `writeheader()` method 
- I had just thought about how I was going to handle writing the headers to the file 
- But actually, I'll need to figure out how this method works because the keys differ across each subset of stations

	DictWriter.writeheader()[](https://docs.python.org/3/library/csv.html#csv.DictWriter.writeheader "Permalink to this definition")
	
	Write a row with the field names (as specified in the constructor) to the writer’s file object, formatted according to the current dialect. Return the return value of the [`csvwriter.writerow()`](https://docs.python.org/3/library/csv.html#csv.csvwriter.writerow "csv.csvwriter.writerow") call used internally.
	
	New in version 3.2.
	
	Changed in version 3.8: [`writeheader()`](https://docs.python.org/3/library/csv.html#csv.DictWriter.writeheader "csv.DictWriter.writeheader") now also returns the value returned by the [`csvwriter.writerow()`](https://docs.python.org/3/library/csv.html#csv.csvwriter.writerow "csv.csvwriter.writerow") method it uses internally.

Doesn't seem to take any arguments, which is a bit strange....

But it appears to call `csvwriter.writerows()` which might give me a clue.



            header = unique_keys(station_data) 
            csv_writer.writerow(header)

Maybe I could try to write the header using the pattern seen above. Then continue with the `DictWriter` class object.

I forgot that `with open` is a pretty cool pattern to employ. Based on the resource that I pulled the other day, that was a simpler but not as robust method. 

``` bash
[athach@fedora stations]$ cat stations.csv
lon,rental_methods,obcn,lat,physical_configuration,cross_street,name,groups,altitude,rental_uris,capacity,address,_ride_code_support,station_id,is_charging_station,post_code,nearby_distance
```

Not sure why the field names are indexed this way. However, it seems like this function works as intended.

``` python
def write_dicts_to_csv():
    with open('stations.csv', 'a', newline='') as csvfile:
```

I asked the function to append to the file instead. 

Opened it in a notebook. Looks good!

# Wrapping Up
Things are moving, slow but steady. Next session I'll work in loading the csv file to my database. Hoping to impute the missing values shortly after.